class e{constructor(){this.offsetCache=new Map,this.dstCache=new Map,this.timezoneAbbreviations={EST:"America/New_York",EDT:"America/New_York",CST:"America/Chicago",CDT:"America/Chicago",MST:"America/Denver",MDT:"America/Denver",PST:"America/Los_Angeles",PDT:"America/Los_Angeles",GMT:"Europe/London",BST:"Europe/London",CET:"Europe/Paris",CEST:"Europe/Paris",JST:"Asia/Tokyo",IST:"Asia/Kolkata",AEST:"Australia/Sydney",AEDT:"Australia/Sydney"},this.timezoneOffsets={UTC:0,"America/New_York":-5,"America/Chicago":-6,"America/Denver":-7,"America/Los_Angeles":-8,"America/Phoenix":-7,"Europe/London":0,"Europe/Paris":1,"Europe/Berlin":1,"Asia/Tokyo":9,"Asia/Shanghai":8,"Asia/Kolkata":5.5,"Australia/Sydney":10,"Pacific/Auckland":12},this.dstRules={"America/New_York":{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:1},"America/Chicago":{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:1},"America/Denver":{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:1},"America/Los_Angeles":{start:{month:3,week:2,day:0},end:{month:11,week:1,day:0},offset:1},"Europe/London":{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:1},"Europe/Paris":{start:{month:3,week:-1,day:0},end:{month:10,week:-1,day:0},offset:1},"Australia/Sydney":{start:{month:10,week:1,day:0},end:{month:4,week:1,day:0},offset:1}}}convertTimezone(e,t,s){if(!e)return null;if(t===s)return new Date(e);const i=this.getTimezoneOffset(e,t),n=60*(this.getTimezoneOffset(e,s)-i)*1e3;return new Date(e.getTime()+n)}toUTC(e,t){if(!e)return null;if("UTC"===t)return new Date(e);const s=this.getTimezoneOffset(e,t);return new Date(e.getTime()-60*s*1e3)}fromUTC(e,t){if(!e)return null;if("UTC"===t)return new Date(e);const s=this.getTimezoneOffset(e,t);return new Date(e.getTime()+60*s*1e3)}getTimezoneOffset(e,t){const s=`${t}_${e.getFullYear()}_${e.getMonth()}_${e.getDate()}`;if(this.offsetCache.has(s))return this.offsetCache.get(s);if("undefined"!=typeof Intl&&Intl.DateTimeFormat)try{const i=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(e),n=(new Date(i.find(e=>"year"===e.type).value,i.find(e=>"month"===e.type).value-1,i.find(e=>"day"===e.type).value,i.find(e=>"hour"===e.type).value,i.find(e=>"minute"===e.type).value,i.find(e=>"second"===e.type).value).getTime()-e.getTime())/6e4;return this.offsetCache.set(s,-n),-n}catch(e){}let i=60*(this.timezoneOffsets[t]||0);if(this.isDST(e,t)){const e=this.dstRules[t];e&&(i+=60*e.offset)}return this.offsetCache.set(s,i),i}isDST(e,t){const s=this.dstRules[t];if(!s)return!1;const i=e.getFullYear(),n=this.getNthWeekdayOfMonth(i,s.start.month,s.start.week,s.start.day),r=this.getNthWeekdayOfMonth(i,s.end.month,s.end.week,s.end.day);return n>r?e>=n||e<r:e>=n&&e<r}getNthWeekdayOfMonth(e,t,s,i){const n=new Date(e,t,1);let r=i-n.getDay();if(r<0&&(r+=7),s>0)n.setDate(1+r+7*(s-1));else{const r=new Date(e,t+1,0).getDate();n.setDate(r);let a=n.getDay()-i;a<0&&(a+=7),n.setDate(r-a+7*(s+1))}return n}getCommonTimezones(){const e=new Date;return[{value:"America/New_York",label:"Eastern Time (New York)",region:"Americas"},{value:"America/Chicago",label:"Central Time (Chicago)",region:"Americas"},{value:"America/Denver",label:"Mountain Time (Denver)",region:"Americas"},{value:"America/Phoenix",label:"Mountain Time - Arizona (Phoenix)",region:"Americas"},{value:"America/Los_Angeles",label:"Pacific Time (Los Angeles)",region:"Americas"},{value:"America/Anchorage",label:"Alaska Time (Anchorage)",region:"Americas"},{value:"Pacific/Honolulu",label:"Hawaii Time (Honolulu)",region:"Pacific"},{value:"America/Toronto",label:"Eastern Time (Toronto)",region:"Americas"},{value:"America/Vancouver",label:"Pacific Time (Vancouver)",region:"Americas"},{value:"America/Mexico_City",label:"Central Time (Mexico City)",region:"Americas"},{value:"America/Sao_Paulo",label:"Brasilia Time (SÃ£o Paulo)",region:"Americas"},{value:"Europe/London",label:"GMT/BST (London)",region:"Europe"},{value:"Europe/Paris",label:"Central European Time (Paris)",region:"Europe"},{value:"Europe/Berlin",label:"Central European Time (Berlin)",region:"Europe"},{value:"Europe/Moscow",label:"Moscow Time",region:"Europe"},{value:"Asia/Dubai",label:"Gulf Time (Dubai)",region:"Asia"},{value:"Asia/Kolkata",label:"India Time (Mumbai)",region:"Asia"},{value:"Asia/Shanghai",label:"China Time (Shanghai)",region:"Asia"},{value:"Asia/Tokyo",label:"Japan Time (Tokyo)",region:"Asia"},{value:"Asia/Seoul",label:"Korea Time (Seoul)",region:"Asia"},{value:"Asia/Singapore",label:"Singapore Time",region:"Asia"},{value:"Australia/Sydney",label:"Australian Eastern Time (Sydney)",region:"Oceania"},{value:"Australia/Melbourne",label:"Australian Eastern Time (Melbourne)",region:"Oceania"},{value:"Pacific/Auckland",label:"New Zealand Time (Auckland)",region:"Oceania"},{value:"UTC",label:"UTC",region:"UTC"}].map(t=>{const s=this.getTimezoneOffset(e,t.value),i=-s/60,n=Math.floor(Math.abs(i)),r=Math.round(60*Math.abs(i%1)),a=`UTC${i>=0?"+":"-"}${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;return{...t,offset:a,offsetMinutes:-s}}).sort((e,t)=>e.offsetMinutes-t.offsetMinutes)}formatInTimezone(e,t,s={}){if(!e)return"";const i={...{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:t},...s};try{return new Intl.DateTimeFormat("en-US",i).format(e)}catch(i){return this.fromUTC(this.toUTC(e,"UTC"),t).toLocaleString("en-US",s)}}getSystemTimezone(){if("undefined"!=typeof Intl&&Intl.DateTimeFormat)try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}const e=-(new Date).getTimezoneOffset()/60;for(const[t,s]of Object.entries(this.timezoneOffsets))if(s===e)return t;return"UTC"}parseTimezone(e){if(!e)return"UTC";if(this.timezoneOffsets.hasOwnProperty(e))return e;const t=e.toUpperCase();if(this.timezoneAbbreviations.hasOwnProperty(t))return this.timezoneAbbreviations[t];const s=e.match(/^([+-])(\d{2}):?(\d{2})$/);if(s){const e=("+"===s[1]?1:-1)*(parseInt(s[2],10)+parseInt(s[3],10)/60);for(const[t,s]of Object.entries(this.timezoneOffsets))if(s===e)return t}return"UTC"}getTimezoneDifference(e,t,s=new Date){const i=this.getTimezoneOffset(s,e);return(this.getTimezoneOffset(s,t)-i)/60}clearCache(){this.offsetCache.clear(),this.dstCache.clear()}}class t{static normalize(e){const t={...e};!t.start||t.start instanceof Date||(t.start=new Date(t.start)),!t.end||t.end instanceof Date||(t.end=new Date(t.end)),t.end||(t.end=t.start?new Date(t.start):null),t.allDay&&t.start&&(t.start.setHours(0,0,0,0),t.end&&t.end.setHours(23,59,59,999)),t.id=String(t.id||"").trim(),t.title=String(t.title||"").trim(),t.description=String(t.description||"").trim(),t.location=String(t.location||"").trim(),t.attendees=Array.isArray(t.attendees)?t.attendees:[],t.reminders=Array.isArray(t.reminders)?t.reminders:[],t.categories=Array.isArray(t.categories)?t.categories:[],t.attachments=Array.isArray(t.attachments)?t.attachments:[];["confirmed","tentative","cancelled"].includes(t.status)||(t.status="confirmed");return["public","private","confidential"].includes(t.visibility)||(t.visibility="public"),t.color&&!t.backgroundColor&&(t.backgroundColor=t.color),t.color&&!t.borderColor&&(t.borderColor=t.color),t}static validate(e){if(!e.id)throw new Error("Event must have an id");if(!e.title)throw new Error("Event must have a title");if(!e.start)throw new Error("Event must have a start date");if(!(e.start instanceof Date)||isNaN(e.start.getTime()))throw new Error("Invalid start date");if(e.end&&(!(e.end instanceof Date)||isNaN(e.end.getTime())))throw new Error("Invalid end date");if(e.end&&e.start&&e.end<e.start)throw new Error("Event end time cannot be before start time");if(e.recurring&&!e.recurrenceRule)throw new Error("Recurring events must have a recurrence rule");if(e.attendees&&e.attendees.length>0&&e.attendees.forEach((e,t)=>{if(!e.email||!e.name)throw new Error(`Attendee at index ${t} must have email and name`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))throw new Error(`Invalid email for attendee: ${e.email}`)}),e.reminders&&e.reminders.length>0&&e.reminders.forEach((e,t)=>{if(!e.method||null==e.minutesBefore)throw new Error(`Reminder at index ${t} must have method and minutesBefore`);if(e.minutesBefore<0)throw new Error("Reminder minutesBefore must be non-negative")}),e.timeZone)try{new Intl.DateTimeFormat("en-US",{timeZone:e.timeZone})}catch(t){throw new Error(`Invalid timezone: ${e.timeZone}`)}}constructor({id:s,title:i,start:n,end:r,allDay:a=!1,description:o="",location:c="",color:h=null,backgroundColor:l=null,borderColor:d=null,textColor:u=null,recurring:m=!1,recurrenceRule:g=null,timeZone:f=null,endTimeZone:y=null,status:v="confirmed",visibility:D="public",organizer:p=null,attendees:w=[],reminders:b=[],categories:T=[],attachments:S=[],conferenceData:E=null,metadata:C={}}){const M=t.normalize({id:s,title:i,start:n,end:r,allDay:a,description:o,location:c,color:h,backgroundColor:l,borderColor:d,textColor:u,recurring:m,recurrenceRule:g,timeZone:f,endTimeZone:y,status:v,visibility:D,organizer:p,attendees:w,reminders:b,categories:T,attachments:S,conferenceData:E,metadata:C});t.validate(M),this.id=M.id,this.title=M.title,this._timezoneManager=new e,this.timeZone=M.timeZone||this._timezoneManager.getSystemTimezone(),this.endTimeZone=M.endTimeZone||this.timeZone,this.start=M.start,this.end=M.end,this.startUTC=this._timezoneManager.toUTC(this.start,this.timeZone),this.endUTC=this._timezoneManager.toUTC(this.end,this.endTimeZone),this.allDay=M.allDay,this.description=M.description,this.location=M.location,this.color=M.color,this.backgroundColor=M.backgroundColor,this.borderColor=M.borderColor,this.textColor=M.textColor,this.recurring=M.recurring,this.recurrenceRule=M.recurrenceRule,this._originalTimeZone=M.timeZone||null,this.status=M.status,this.visibility=M.visibility,this.organizer=M.organizer,this.attendees=[...M.attendees],this.reminders=[...M.reminders],this.categories=[...M.categories],this.attachments=[...M.attachments],this.conferenceData=M.conferenceData,this.metadata={...M.metadata},this._cache={},this._validateAttendees(),this._validateReminders()}get duration(){return this._cache.duration||(this._cache.duration=this.endUTC.getTime()-this.startUTC.getTime()),this._cache.duration}getStartInTimezone(e){return e===this.timeZone?new Date(this.start):this._timezoneManager.fromUTC(this.startUTC,e)}getEndInTimezone(e){return e===this.endTimeZone?new Date(this.end):this._timezoneManager.fromUTC(this.endUTC,e)}updateTimes(e,t,s){if(s||this.timeZone,this.start=e instanceof Date?e:new Date(e),this.end=t instanceof Date?t:new Date(t),s&&(this.timeZone=s,this.endTimeZone=s),this.startUTC=this._timezoneManager.toUTC(this.start,this.timeZone),this.endUTC=this._timezoneManager.toUTC(this.end,this.endTimeZone),this._cache={},this.endUTC<this.startUTC)throw new Error("Event end time cannot be before start time")}get durationMinutes(){return Math.floor(this.duration/6e4)}get durationHours(){return this.duration/36e5}get isMultiDay(){if(!this._cache.hasOwnProperty("isMultiDay")){const e=this.start.toDateString(),t=this.end.toDateString();this._cache.isMultiDay=e!==t}return this._cache.isMultiDay}isRecurring(){return this.recurring&&null!==this.recurrenceRule}occursOn(e){e instanceof Date||(e=new Date(e));const t=e.toDateString(),s=this.start.toDateString(),i=this.end.toDateString();if(this.allDay)return e>=new Date(s)&&e<=new Date(i);if(this.isMultiDay){const e=new Date(t),s=new Date(t);return s.setHours(23,59,59,999),this.start<=s&&this.end>=e}return s===t}overlaps(e){if(e instanceof t)return!(this.end<=e.start||this.start>=e.end);if(e&&e.start&&e.end)return!(this.end<=e.start||this.start>=e.end);throw new Error("Parameter must be an Event instance or have start/end properties")}contains(e){return e instanceof Date||(e=new Date(e)),e>=this.start&&e<=this.end}clone(e={}){return new t({id:this.id,title:this.title,start:new Date(this.start),end:new Date(this.end),allDay:this.allDay,description:this.description,location:this.location,color:this.color,backgroundColor:this.backgroundColor,borderColor:this.borderColor,textColor:this.textColor,recurring:this.recurring,recurrenceRule:this.recurrenceRule,timeZone:this.timeZone,status:this.status,visibility:this.visibility,organizer:this.organizer?{...this.organizer}:null,attendees:this.attendees.map(e=>({...e})),reminders:this.reminders.map(e=>({...e})),categories:[...this.categories],attachments:this.attachments.map(e=>({...e})),conferenceData:this.conferenceData?{...this.conferenceData}:null,metadata:{...this.metadata},...e})}toObject(){return{id:this.id,title:this.title,start:this.start.toISOString(),end:this.end.toISOString(),allDay:this.allDay,description:this.description,location:this.location,color:this.color,backgroundColor:this.backgroundColor,borderColor:this.borderColor,textColor:this.textColor,recurring:this.recurring,recurrenceRule:this.recurrenceRule,timeZone:this.timeZone,status:this.status,visibility:this.visibility,organizer:this.organizer,attendees:this.attendees,reminders:this.reminders,categories:this.categories,attachments:this.attachments,conferenceData:this.conferenceData,metadata:{...this.metadata}}}static fromObject(e){return new t(e)}equals(e){return e instanceof t&&(this.id===e.id&&this.title===e.title&&this.start.getTime()===e.start.getTime()&&this.end.getTime()===e.end.getTime()&&this.allDay===e.allDay&&this.description===e.description&&this.location===e.location&&this.recurring===e.recurring&&this.recurrenceRule===e.recurrenceRule&&this.status===e.status)}addAttendee(e){if(!e||!e.email)throw new Error("Attendee must have an email");return!this.hasAttendee(e.email)&&(e.id||(e.id=`attendee_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.responseStatus=e.responseStatus||"needs-action",e.role=e.role||"required",this.attendees.push(e),!0)}removeAttendee(e){const t=this.attendees.findIndex(t=>t.email===e||t.id===e);return-1!==t&&(this.attendees.splice(t,1),!0)}updateAttendeeResponse(e,t){const s=this.getAttendee(e);return!!s&&(s.responseStatus=t,s.responseTime=new Date,!0)}getAttendee(e){return this.attendees.find(t=>t.email===e)||null}hasAttendee(e){return this.attendees.some(t=>t.email===e)}getAttendeesByStatus(e){return this.attendees.filter(t=>t.responseStatus===e)}getAttendeeCounts(){return this.attendees.reduce((e,t)=>{const s=t.responseStatus||"needs-action";return e[s]=(e[s]||0)+1,e},{})}addReminder(e){if(!e||"number"!=typeof e.minutesBefore)throw new Error("Reminder must have minutesBefore property");e.id||(e.id=`reminder_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.method=e.method||"popup",e.enabled=!1!==e.enabled;return!this.reminders.some(t=>t.method===e.method&&t.minutesBefore===e.minutesBefore)&&(this.reminders.push(e),!0)}removeReminder(e){const t=this.reminders.findIndex(t=>t.id===e);return-1!==t&&(this.reminders.splice(t,1),!0)}getActiveReminders(){return this.reminders.filter(e=>!1!==e.enabled)}getReminderTriggerTimes(){return this.getActiveReminders().map(e=>{const t=new Date(this.start);return t.setMinutes(t.getMinutes()-e.minutesBefore),t})}addCategory(e){if(!e||"string"!=typeof e)throw new Error("Category must be a non-empty string");const t=e.trim().toLowerCase();return!this.hasCategory(t)&&(this.categories.push(t),!0)}removeCategory(e){const t=e.trim().toLowerCase(),s=this.categories.findIndex(e=>e.toLowerCase()===t);return-1!==s&&(this.categories.splice(s,1),!0)}hasCategory(e){const t=e.trim().toLowerCase();return this.categories.some(e=>e.toLowerCase()===t)}hasAnyCategory(e){return e.some(e=>this.hasCategory(e))}hasAllCategories(e){return e.every(e=>this.hasCategory(e))}_validateAttendees(){for(const e of this.attendees){if(!e.email)throw new Error("All attendees must have an email address");if(e.name||(e.name=e.email),!this._isValidEmail(e.email))throw new Error(`Invalid attendee email: ${e.email}`)}}_validateReminders(){for(const e of this.reminders){if("number"!=typeof e.minutesBefore||e.minutesBefore<0)throw new Error("Reminder minutesBefore must be a positive number");if(!["email","popup","sms"].includes(e.method))throw new Error(`Invalid reminder method: ${e.method}`)}}_isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}get isCancelled(){return"cancelled"===this.status}get isTentative(){return"tentative"===this.status}get isConfirmed(){return"confirmed"===this.status}get isPrivate(){return"private"===this.visibility}get isPublic(){return"public"===this.visibility}get hasAttendees(){return this.attendees.length>0}get hasReminders(){return this.reminders.length>0}get isMeeting(){return this.hasAttendees||null!==this.conferenceData}get isVirtual(){return null!==this.conferenceData}}class s{static startOfDay(e){const t=new Date(e);return t.setHours(0,0,0,0),t}static endOfDay(e){const t=new Date(e);return t.setHours(23,59,59,999),t}static startOfWeek(e,t=0){const s=new Date(e),i=s.getDay(),n=(i<t?7:0)+i-t;return s.setTime(s.getTime()-24*n*60*60*1e3),s.setHours(0,0,0,0),s}static endOfWeek(e,t=0){const i=s.startOfWeek(e,t);return i.setTime(i.getTime()+5184e5),i.setHours(23,59,59,999),i}static startOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0)}static endOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59,999)}static startOfYear(e){return new Date(e.getFullYear(),0,1,0,0,0,0)}static endOfYear(e){return new Date(e.getFullYear(),11,31,23,59,59,999)}static addDays(e,t){const s=new Date(e);return s.setTime(s.getTime()+24*t*60*60*1e3),s}static addWeeks(e,t){return s.addDays(e,7*t)}static addMonths(e,t){const s=new Date(e),i=s.getDate();return s.setMonth(s.getMonth()+t),s.getDate()!==i&&s.setDate(0),s}static addYears(e,t){const s=new Date(e);return s.setFullYear(s.getFullYear()+t),s}static isToday(e){const t=new Date;return e.toDateString()===t.toDateString()}static isPast(e){return e<new Date}static isFuture(e){return e>new Date}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static isSameWeek(e,t,i=0){const n=s.startOfWeek(e,i),r=s.startOfWeek(t,i);return n.toDateString()===r.toDateString()}static isSameMonth(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()}static isSameYear(e,t){return e.getFullYear()===t.getFullYear()}static differenceInDays(e,t){const s=e.getTime()-t.getTime();return Math.floor(s/864e5)}static differenceInWeeks(e,t){return Math.floor(s.differenceInDays(e,t)/7)}static differenceInMonths(e,t){return 12*(e.getFullYear()-t.getFullYear())+(e.getMonth()-t.getMonth())}static getWeekNumber(e){const t=new Date(e.getFullYear(),0,1),s=(e-t)/864e5;return Math.ceil((s+t.getDay()+1)/7)}static getDayOfWeek(e,t=0){return(e.getDay()-t+7)%7}static getDaysInMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}static format(e,t="en-US",s={}){return new Intl.DateTimeFormat(t,s).format(e)}static getMonthName(e,t="en-US",i="long"){return s.format(e,t,{month:i})}static getDayName(e,t="en-US",i="long"){return s.format(e,t,{weekday:i})}static formatTime(e,t="en-US",i=!1){return s.format(e,t,{hour:"numeric",minute:"2-digit",hour12:!i})}static parseTime(e){const[t,s]=e.split(":").map(Number);return{hours:t,minutes:s}}static setTime(e,t){const i=new Date(e),{hours:n,minutes:r}=s.parseTime(t);return i.setHours(n,r,0,0),i}static isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}static getDateRange(e,t){const s=[],i=new Date(e),n=t.getTime();for(;i.getTime()<=n;)s.push(new Date(i)),i.setTime(i.getTime()+864e5);return s}static clone(e){return new Date(e)}static isValidDate(e){return e instanceof Date&&!isNaN(e.getTime())}static toTimeZone(e,t){const s=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(e),i={};return s.forEach(e=>{"literal"!==e.type&&(i[e.type]=e.value)}),new Date(`${i.year}-${i.month}-${i.day}T${i.hour}:${i.minute}:${i.second}`)}static getTimezoneOffset(e,t){const s=new Date(e.toLocaleString("en-US",{timeZone:"UTC"})),i=new Date(e.toLocaleString("en-US",{timeZone:t}));return(s.getTime()-i.getTime())/6e4}static isDST(e,t){const i=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=s.getTimezoneOffset(i,t),a=s.getTimezoneOffset(n,t),o=s.getTimezoneOffset(e,t);return Math.max(r,a)===o}static addHoursWithDST(e,t,i){const n=new Date(e),r=s.getTimezoneOffset(e,i);n.setTime(n.getTime()+60*t*60*1e3);const a=s.getTimezoneOffset(n,i);if(r!==a){const e=6e4*(a-r);n.setTime(n.getTime()+e)}return n}static createInTimeZone(e,t,i,n=0,r=0,a=0,o){const c=`${e}-${String(t+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,h=`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}`,l=new Date(`${c}T${h}`),d=s.getTimezoneOffset(l,o),u=l.getTime()+6e4*d;return new Date(u)}}class i{static expandEvent(t,s,i,n=365,r=null){if(!t.recurring||!t.recurrenceRule)return[{start:t.start,end:t.end,timezone:t.timeZone}];const a=this.parseRule(t.recurrenceRule),o=[],c=t.end-t.start,h=r||t.timeZone||"UTC",l=new e;let d=new Date(t.start),u=0;a.until&&a.until<i&&(i=a.until);let m=l.getTimezoneOffset(d,h);for(;d<=i&&u<n;){if(d>=s){const e=new Date(d),s=new Date(d.getTime()+c),i=l.getTimezoneOffset(e,h);if(i!==m){const t=m-i;e.setMinutes(e.getMinutes()+t),s.setMinutes(s.getMinutes()+t)}m=i,this.isException(e,a,t.id)||o.push({start:e,end:s,recurringEventId:t.id,timezone:h,originalStart:t.start})}if(d=this.getNextOccurrence(d,a,h),u++,a.count&&u>=a.count)break}return o}static parseRule(e){const t={freq:null,interval:1,count:null,until:null,byDay:[],byMonthDay:[],byMonth:[],bySetPos:[],exceptions:[]};if("object"==typeof e)return{...t,...e};return e.split(";").forEach(e=>{const[s,i]=e.split("=");switch(s.toUpperCase()){case"FREQ":t.freq=i.toUpperCase();break;case"INTERVAL":t.interval=parseInt(i,10);break;case"COUNT":t.count=parseInt(i,10);break;case"UNTIL":t.until=this.parseDate(i);break;case"BYDAY":t.byDay=i.split(",");break;case"BYMONTHDAY":t.byMonthDay=i.split(",").map(e=>parseInt(e,10));break;case"BYMONTH":t.byMonth=i.split(",").map(e=>parseInt(e,10));break;case"BYSETPOS":t.bySetPos=i.split(",").map(e=>parseInt(e,10))}}),t}static getNextOccurrence(e,t,s="UTC"){const i=new Date(e);switch(t.freq){case"DAILY":i.setDate(i.getDate()+t.interval);break;case"WEEKLY":if(t.byDay&&t.byDay.length>0)for(i.setDate(i.getDate()+1);!this.matchesByDay(i,t.byDay);)i.setDate(i.getDate()+1);else i.setDate(i.getDate()+7*t.interval);break;case"MONTHLY":if(t.byMonthDay&&t.byMonthDay.length>0){const e=i.getMonth();i.setMonth(e+t.interval),i.setDate(t.byMonthDay[0])}else t.byDay&&t.byDay.length>0?(i.setMonth(i.getMonth()+t.interval),this.setToWeekdayOfMonth(i,t.byDay[0],t.bySetPos[0]||1)):i.setMonth(i.getMonth()+t.interval);break;case"YEARLY":t.byMonth&&t.byMonth.length>0?(i.setFullYear(i.getFullYear()+t.interval),i.setMonth(t.byMonth[0]-1)):i.setFullYear(i.getFullYear()+t.interval);break;default:i.setTime(i.getTime()+864e5)}return i}static matchesByDay(e,t){const s={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6},i=e.getDay();return t.some(e=>{const t=e.match(/^(-?\d+)?([A-Z]{2})$/);if(t){const e=t[2];return s[e]===i}return!1})}static setToWeekdayOfMonth(e,t,s=1){const i=t.match(/^(-?\d+)?([A-Z]{2})$/),n={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6}[i?i[2]:t];for(e.setDate(1);e.getDay()!==n;)e.setDate(e.getDate()+1);if(s>1)e.setDate(e.getDate()+7*(s-1));else if(-1===s){const t=new Date(e);for(t.setMonth(t.getMonth()+1),t.setDate(0);t.getDay()!==n;)t.setDate(t.getDate()-1);e.setTime(t.getTime())}}static isException(e,t,s=null){if(!t.exceptions||0===t.exceptions.length)return!1;const i=e.toDateString(),n=e.getTime();return t.exceptions.some(e=>{if("object"==typeof e&&e.date){const t=e.date instanceof Date?e.date:new Date(e.date);return e.matchTime?Math.abs(t.getTime()-n)<1e3:t.toDateString()===i}return(e instanceof Date?e:new Date(e)).toDateString()===i})}static addExceptions(e,t,s={}){e.exceptions||(e.exceptions=[]);return(Array.isArray(t)?t:[t]).forEach(t=>{s.reason||s.matchTime?e.exceptions.push({date:t,reason:s.reason,matchTime:s.matchTime||!1}):e.exceptions.push(t)}),e}static parseDate(e){if(8===e.length){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10);return new Date(t,s,i)}if(15===e.length||16===e.length){const t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),n=parseInt(e.substr(9,2),10),r=parseInt(e.substr(11,2),10),a=parseInt(e.substr(13,2),10);return e.endsWith("Z")?new Date(Date.UTC(t,s,i,n,r,a)):new Date(t,s,i,n,r,a)}return new Date(e)}static getDescription(e){"string"==typeof e&&(e=this.parseRule(e));let t="";const s=e.interval||1;switch(e.freq){case"DAILY":t=1===s?"Daily":`Every ${s} days`;break;case"WEEKLY":if(t=1===s?"Weekly":`Every ${s} weeks`,e.byDay&&e.byDay.length>0){t+=` on ${e.byDay.map(e=>this.getDayName(e)).join(", ")}`}break;case"MONTHLY":t=1===s?"Monthly":`Every ${s} months`,e.byMonthDay&&e.byMonthDay.length>0&&(t+=` on day ${e.byMonthDay.join(", ")}`);break;case"YEARLY":t=1===s?"Yearly":`Every ${s} years`}return e.count?t+=`, ${e.count} times`:e.until&&(t+=`, until ${e.until.toLocaleDateString()}`),t}static getDayName(e){const t=e.match(/^(-?\d+)?([A-Z]{2})$/),s=t?t[2]:e,i=t&&t[1]?parseInt(t[1],10):null;let n={SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[s]||e;if(i){n=`${-1===i?"Last":["","1st","2nd","3rd","4th","5th"][i]||`${i}th`} ${n}`}return n}}class n{constructor(e=100){this.capacity=e,this.cache=new Map,this.hits=0,this.misses=0,this.evictions=0}get(e){if(!this.cache.has(e))return void this.misses++;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),this.hits++,t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e),this.evictions++}this.cache.set(e,t)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear(),this.hits=0,this.misses=0,this.evictions=0}getStats(){const e=this.hits+this.misses>0?(this.hits/(this.hits+this.misses)*100).toFixed(2):0;return{size:this.cache.size,capacity:this.capacity,hits:this.hits,misses:this.misses,evictions:this.evictions,hitRate:`${e}%`}}keys(){return Array.from(this.cache.keys())}get size(){return this.cache.size}}class r{constructor(e={}){this.config={enableCache:!0,cacheCapacity:500,maxIndexDays:365,batchSize:100,enableMetrics:!0,cleanupInterval:36e5,maxIndexAge:2592e6,...e},this.eventCache=new n(this.config.cacheCapacity),this.queryCache=new n(Math.floor(this.config.cacheCapacity/2)),this.dateRangeCache=new n(Math.floor(this.config.cacheCapacity/4)),this.lazyIndexes=new Map,this.pendingIndexes=new Map,this.batchQueue=[],this.batchTimer=null,this.batchCallbacks=[],this.metrics={operations:{},averageTimes:{},slowQueries:[]},this.cleanupTimer=null,this.config.cleanupInterval>0&&this.startCleanupTimer()}measure(e,t){if(!this.config.enableMetrics)return t();const s=performance.now();try{const i=t(),n=performance.now()-s;return this.recordMetric(e,n),i}catch(t){const i=performance.now()-s;throw this.recordMetric(e,i,!0),t}}async measureAsync(e,t){if(!this.config.enableMetrics)return await t();const s=performance.now();try{const i=await t(),n=performance.now()-s;return this.recordMetric(e,n),i}catch(t){const i=performance.now()-s;throw this.recordMetric(e,i,!0),t}}recordMetric(e,t,s=!1){this.metrics.operations[e]||(this.metrics.operations[e]={count:0,totalTime:0,errors:0,min:1/0,max:0});const i=this.metrics.operations[e];i.count++,i.totalTime+=t,i.min=Math.min(i.min,t),i.max=Math.max(i.max,t),s&&i.errors++,this.metrics.averageTimes[e]=i.totalTime/i.count,t>100&&(this.metrics.slowQueries.push({operation:e,duration:t,timestamp:new Date,isError:s}),this.metrics.slowQueries.length>100&&this.metrics.slowQueries.shift())}getMetrics(){const e={cacheStats:{event:this.eventCache.getStats(),query:this.queryCache.getStats(),dateRange:this.dateRangeCache.getStats()},operations:{},slowestOperations:[],recentSlowQueries:this.metrics.slowQueries.slice(-10)};for(const[t,s]of Object.entries(this.metrics.operations))e.operations[t]={count:s.count,avgTime:`${(s.totalTime/s.count).toFixed(2)}ms`,minTime:`${s.min.toFixed(2)}ms`,maxTime:`${s.max.toFixed(2)}ms`,totalTime:`${s.totalTime.toFixed(2)}ms`,errors:s.errors,errorRate:`${(s.errors/s.count*100).toFixed(2)}%`};return e.slowestOperations=Object.entries(this.metrics.averageTimes).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({operation:e,avgTime:`${t.toFixed(2)}ms`})),e}shouldUseLazyIndexing(e){return Math.ceil((e.end-e.start)/864e5)>this.config.maxIndexDays}createLazyIndexMarkers(e){const t={eventId:e.id,start:e.start,end:e.end,indexed:new Set,pending:!1},s=new Date(e.start.getFullYear(),e.start.getMonth(),1),i=new Date(e.end.getFullYear(),e.end.getMonth(),1);return t.indexed.add(this.getMonthKey(s)),this.getMonthKey(s)!==this.getMonthKey(i)&&t.indexed.add(this.getMonthKey(i)),this.lazyIndexes.set(e.id,t),t}async expandLazyIndex(e,t,s){const i=this.lazyIndexes.get(e);if(!i)return new Set;if(i.pending)return this.pendingIndexes.get(e);i.pending=!0;const n=new Promise(n=>{setTimeout(()=>{const r=new Set,a=new Date(t);for(;a<=s;){const e=a.toDateString();i.indexed.has(e)||(r.add(e),i.indexed.add(e)),a.setDate(a.getDate()+1)}i.pending=!1,this.pendingIndexes.delete(e),n(r)},0)});return this.pendingIndexes.set(e,n),n}getMonthKey(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}cache(e,t,s="event"){if(this.config.enableCache)switch(s){case"event":this.eventCache.put(e,t);break;case"query":this.queryCache.put(e,t);break;case"dateRange":this.dateRangeCache.put(e,t)}}getFromCache(e,t="event"){if(this.config.enableCache)switch(t){case"event":return this.eventCache.get(e);case"query":return this.queryCache.get(e);case"dateRange":return this.dateRangeCache.get(e);default:return}}invalidateEventCaches(e){this.eventCache.delete(e),this.queryCache.clear(),this.dateRangeCache.clear()}batch(e){return new Promise((t,s)=>{this.batchQueue.push(e),this.batchCallbacks.push({resolve:t,reject:s}),this.batchQueue.length>=this.config.batchSize?this.processBatch():this.batchTimer||(this.batchTimer=setTimeout(()=>this.processBatch(),10))})}processBatch(){if(this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),0===this.batchQueue.length)return;const e=this.batchQueue.splice(0),t=this.batchCallbacks.splice(0),s=[],i=[];e.forEach((e,t)=>{try{s[t]=e()}catch(e){i[t]=e}}),t.forEach((e,t)=>{i[t]?e.reject(i[t]):e.resolve(s[t])})}startCleanupTimer(){this.cleanupTimer=setInterval(()=>{this.cleanupOldIndexes()},this.config.cleanupInterval)}cleanupOldIndexes(){const e=Date.now(),t=this.config.maxIndexAge;for(const[s,i]of this.lazyIndexes)i.end.getTime()<e-t&&this.lazyIndexes.delete(s);this.metrics.slowQueries.length>100&&(this.metrics.slowQueries=this.metrics.slowQueries.slice(-100))}optimizeQuery(e,t){const s=this.getFromCache(e,"query");if(void 0!==s)return s;const i=this.measure(`query:${e}`,t);return this.cache(e,i,"query"),i}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),this.eventCache.clear(),this.queryCache.clear(),this.dateRangeCache.clear(),this.lazyIndexes.clear(),this.pendingIndexes.clear()}}class a{constructor(e){this.eventStore=e,this.conflictIdCounter=0}checkConflicts(e,t={}){const s={checkAttendees:!0,checkResources:!0,checkLocation:!0,ignoreAllDay:!1,excludeEventIds:[],includeStatuses:["confirmed","tentative"],bufferMinutes:0,...t};if(!e.start||!e.end)throw new Error("Event must have start and end dates");const i=[],n=new Set,r=new Set,a=new Date(e.start.getTime()-6e4*s.bufferMinutes),o=new Date(e.end.getTime()+6e4*s.bufferMinutes),c=this.eventStore.getEventsInRange(a,o,!1).filter(t=>t.id!==e.id&&(!s.excludeEventIds.includes(t.id)&&(!!s.includeStatuses.includes(t.status)&&((!s.ignoreAllDay||!t.allDay&&!e.allDay)&&"cancelled"!==t.status))));for(const t of c){const a=this._detectEventConflicts(e,t,s);a.length>0&&(i.push(...a),n.add(e.id),n.add(t.id),e.attendees&&e.attendees.forEach(e=>r.add(e.email)),t.attendees&&t.attendees.forEach(e=>r.add(e.email)))}return this._buildConflictSummary(i,n,r)}checkEventPairConflicts(e,t,s={}){const i={checkAttendees:!0,checkResources:!0,checkLocation:!0,bufferMinutes:0,...s};return this._detectEventConflicts(e,t,i)}getBusyPeriods(e,t,s,i={}){const n={includeStatuses:["confirmed","tentative"],mergePeriods:!0,...i},r=[];return this.eventStore.getEventsInRange(t,s,!1).filter(t=>!!n.includeStatuses.includes(t.status)&&("cancelled"!==t.status&&(t.attendees&&t.attendees.some(t=>e.includes(t.email))))).forEach(e=>{r.push({start:e.start,end:e.end,eventIds:[e.id]})}),n.mergePeriods&&r.length>1?this._mergeBusyPeriods(r):r.sort((e,t)=>e.start-t.start)}getFreePeriods(e,t,s,i={}){const n={attendeeEmails:[],businessHoursOnly:!1,businessHours:{start:"09:00",end:"17:00"},excludeWeekends:!1,...i},r=[],a=n.attendeeEmails.length>0?this.getBusyPeriods(n.attendeeEmails,e,t):this._getAllBusyPeriods(e,t);let o=new Date(e);for(const e of a){if(o<e.start){(e.start-o)/6e4>=s&&(n.businessHoursOnly&&!this._isWithinBusinessHours(o,e.start,n)||r.push({start:new Date(o),end:new Date(e.start)}))}o=new Date(Math.max(o.getTime(),e.end.getTime()))}if(o<t){(t-o)/6e4>=s&&(n.businessHoursOnly&&!this._isWithinBusinessHours(o,t,n)||r.push({start:new Date(o),end:new Date(t)}))}return r}_detectEventConflicts(e,t,s){const i=[];if(this._checkTimeOverlap(e,t,s.bufferMinutes)){const n=this._createTimeConflict(e,t);if(i.push(n),s.checkAttendees){const s=this._checkAttendeeConflicts(e,t);i.push(...s)}if(s.checkResources){const s=this._checkResourceConflicts(e,t);i.push(...s)}if(s.checkLocation){const s=this._checkLocationConflict(e,t);s&&i.push(s)}}return i}_checkTimeOverlap(e,t,s=0){const i=6e4*s,n=e.start.getTime()-i,r=e.end.getTime()+i,a=t.start.getTime(),o=t.end.getTime();return!(r<=a||o<=n)}_createTimeConflict(e,t){const s=new Date(Math.max(e.start.getTime(),t.start.getTime())),i=new Date(Math.min(e.end.getTime(),t.end.getTime())),n=(i-s)/6e4;let r="low";return n>=60?r="high":n>=30&&(r="medium"),"confirmed"===e.status&&"confirmed"===t.status&&(r="low"===r?"medium":"medium"===r?"high":"critical"),{id:"conflict_"+ ++this.conflictIdCounter,type:"time",severity:r,eventId:e.id,conflictingEventId:t.id,description:`Time overlap: ${e.title} conflicts with ${t.title}`,overlapStart:s,overlapEnd:i,overlapMinutes:n,metadata:{event1Title:e.title,event2Title:t.title,event1Status:e.status,event2Status:t.status}}}_checkAttendeeConflicts(e,t){const s=[];if(!e.attendees||!t.attendees)return s;const i=[];for(const s of e.attendees)for(const e of t.attendees)s.email===e.email&&i.push(s.email);if(i.length>0){let n="medium";i.some(s=>{const i=e.attendees.find(e=>e.email===s),n=t.attendees.find(e=>e.email===s);return"accepted"===i?.responseStatus&&"accepted"===n?.responseStatus})&&(n="critical"),s.push({id:"conflict_"+ ++this.conflictIdCounter,type:"attendee",severity:n,eventId:e.id,conflictingEventId:t.id,description:`Attendee conflict: ${i.length} attendee(s) double-booked`,conflictingAttendees:i,metadata:{attendeeCount:i.length,attendeeEmails:i}})}return s}_checkResourceConflicts(e,t){const s=[],i=e.attendees?.filter(e=>e.resource)||[],n=t.attendees?.filter(e=>e.resource)||[];for(const r of i)for(const i of n)r.email===i.email&&s.push({id:"conflict_"+ ++this.conflictIdCounter,type:"resource",severity:"critical",eventId:e.id,conflictingEventId:t.id,description:`Resource conflict: ${r.name} is double-booked`,conflictingResource:r.email,metadata:{resourceName:r.name,resourceEmail:r.email}});return s}_checkLocationConflict(e,t){if(!e.location||!t.location)return null;return e.location.trim().toLowerCase()===t.location.trim().toLowerCase()?{id:"conflict_"+ ++this.conflictIdCounter,type:"location",severity:"high",eventId:e.id,conflictingEventId:t.id,description:`Location conflict: ${e.location} is double-booked`,metadata:{location:e.location}}:null}_buildConflictSummary(e,t,s){const i={},n={};for(const t of e)i[t.type]=(i[t.type]||0)+1,n[t.severity]=(n[t.severity]||0)+1;return{hasConflicts:e.length>0,totalConflicts:e.length,conflicts:e,conflictsByType:i,conflictsBySeverity:n,affectedEventIds:Array.from(t),affectedAttendees:Array.from(s)}}_mergeBusyPeriods(e){if(e.length<=1)return e;e.sort((e,t)=>e.start-t.start);const t=[e[0]];for(let s=1;s<e.length;s++){const i=e[s],n=t[t.length-1];i.start<=n.end?(n.end=new Date(Math.max(n.end.getTime(),i.end.getTime())),n.eventIds.push(...i.eventIds)):t.push(i)}return t}_getAllBusyPeriods(e,t){return this.eventStore.getEventsInRange(e,t,!1).filter(e=>"cancelled"!==e.status).map(e=>({start:e.start,end:e.end,eventIds:[e.id]})).sort((e,t)=>e.start-t.start)}_isWithinBusinessHours(e,t,s){const i=e.getHours(),n=t.getHours(),r=parseInt(s.businessHours.start.split(":")[0]),a=parseInt(s.businessHours.end.split(":")[0]);return i>=r&&n<=a}}class o{constructor(t={}){this.events=new Map,this.indices={byDate:new Map,byMonth:new Map,recurring:new Set,byCategory:new Map,byStatus:new Map},this.timezoneManager=new e,this.defaultTimezone=t.timezone||this.timezoneManager.getSystemTimezone(),this.optimizer=new r(t.performance),this.conflictDetector=new a(this),this.isBatchMode=!1,this.batchNotifications=[],this.batchBackup=null,this.version=0,this.listeners=new Set}addEvent(e){return this.optimizer.measure("addEvent",()=>{if(e instanceof t||(e=new t(e)),this.events.has(e.id))throw new Error(`Event with id ${e.id} already exists`);return this.events.set(e.id,e),this.optimizer.cache(e.id,e,"event"),this._indexEvent(e),this.isBatchMode?this.batchNotifications.push({type:"add",event:e,version:++this.version}):this._notifyChange({type:"add",event:e,version:++this.version}),e})}updateEvent(e,t){const s=this.events.get(e);if(!s)throw new Error(`Event with id ${e} not found`);this._unindexEvent(s);const i=s.clone(t);return this.events.set(e,i),this._indexEvent(i),this._notifyChange({type:"update",event:i,oldEvent:s,version:++this.version}),i}removeEvent(e){const t=this.events.get(e);return!!t&&(this.events.delete(e),this._unindexEvent(t),this._notifyChange({type:"remove",event:t,version:++this.version}),!0)}getEvent(e){const t=this.optimizer.getFromCache(e,"event");if(t)return t;const s=this.events.get(e)||null;return s&&this.optimizer.cache(e,s,"event"),s}getAllEvents(){return Array.from(this.events.values())}queryEvents(e={}){let t=Array.from(this.events.values());if(e.start||e.end){const s=e.start?new Date(e.start):null,i=e.end?new Date(e.end):null;t=t.filter(e=>!(s&&e.end<s)&&!(i&&e.start>i))}if(e.date){const s=new Date(e.date);t=t.filter(e=>e.occursOn(s))}if(e.month&&e.year){const s=`${e.year}-${String(e.month).padStart(2,"0")}`,i=this.indices.byMonth.get(s)||new Set;t=t.filter(e=>i.has(e.id))}return e.hasOwnProperty("allDay")&&(t=t.filter(t=>t.allDay===e.allDay)),e.hasOwnProperty("recurring")&&(t=t.filter(t=>t.recurring===e.recurring)),e.status&&(t=t.filter(t=>t.status===e.status)),e.categories&&e.categories.length>0&&(t=t.filter(t=>e.matchAllCategories?t.hasAllCategories(e.categories):t.hasAnyCategory(e.categories))),e.hasOwnProperty("hasAttendees")&&(t=t.filter(t=>e.hasAttendees?t.hasAttendees:!t.hasAttendees)),e.organizerEmail&&(t=t.filter(t=>t.organizer&&t.organizer.email===e.organizerEmail)),e.sort&&t.sort((t,s)=>{switch(e.sort){case"start":return t.start-s.start;case"end":return t.end-s.end;case"duration":return t.duration-s.duration;case"title":return t.title.localeCompare(s.title);default:return 0}}),t}getEventsForDate(e,t=null){t=t||this.defaultTimezone;const s=new Date(e);s.setHours(0,0,0,0);const i=new Date(e);i.setHours(23,59,59,999);const n=this.timezoneManager.toUTC(s,t),r=this.timezoneManager.toUTC(i,t),a=n.toDateString(),o=this.indices.byDate.get(a)||new Set;return Array.from(o).map(e=>this.events.get(e)).filter(e=>!!e&&(e.startUTC<=r&&e.endUTC>=n)).sort((e,s)=>{const i=e.getStartInTimezone(t)-s.getStartInTimezone(t);return 0!==i?i:s.duration-e.duration})}getOverlappingEvents(e,t,i=null){const n=[],r=s.startOfDay(e),a=s.endOfDay(t),o=s.getDateRange(r,a),c=new Set;return o.forEach(s=>{const r=s.toDateString();(this.indices.byDate.get(r)||new Set).forEach(s=>{if(!c.has(s)&&s!==i){c.add(s);const i=this.events.get(s);i&&i.overlaps({start:e,end:t})&&n.push(i)}})}),n.sort((e,t)=>e.start-t.start)}hasConflicts(e,t,s=null){return this.getOverlappingEvents(e,t,s).length>0}getOverlapGroups(e,t=!0){let s=this.getEventsForDate(e);t&&(s=s.filter(e=>!e.allDay));const i=[],n=new Set;return s.forEach(e=>{if(n.has(e.id))return;const t=[e];n.add(e.id);let r=0;for(;r<t.length;){const e=t[r];s.forEach(s=>{!n.has(s.id)&&e.overlaps(s)&&(t.push(s),n.add(s.id))}),r++}i.push(t)}),i}calculateEventPositions(e){const t=new Map;if(0===e.length)return t;e.sort((e,t)=>{const s=e.start-t.start;return 0!==s?s:t.end-t.start-(e.end-e.start)});const s=[];e.forEach(e=>{let i=0;for(;i<s.length;){if(!s[i].some(t=>t.overlaps(e)))break;i++}s[i]||(s[i]=[]),s[i].push(e),t.set(e.id,{column:i,totalColumns:0})});const i=s.length;return t.forEach(e=>{e.totalColumns=i}),t}getEventsInRange(e,t,s=!0,i=null){"string"==typeof s&&(i=s,s=!0),i=i||this.defaultTimezone;const n=this.timezoneManager.toUTC(e,i),r=this.timezoneManager.toUTC(t,i),a=this.queryEvents({start:n,end:r,sort:"start"});if(!s)return a;const o=[];return a.forEach(s=>{if(s.recurring&&s.recurrenceRule){const n=this.expandRecurringEvent(s,e,t,i);o.push(...n)}else o.push(s)}),o.sort((e,t)=>e.getStartInTimezone(i)-t.getStartInTimezone(i))}expandRecurringEvent(e,t,s,n=null){if(!e.recurring||!e.recurrenceRule)return[e];n=n||this.defaultTimezone;const r=e.timeZone||n;return i.expandEvent(e,t,s).map((t,s)=>e.clone({id:`${e.id}_occurrence_${s}`,start:t.start,end:t.end,timeZone:r,metadata:{...e.metadata,recurringEventId:e.id,occurrenceIndex:s}}))}clear(){const e=this.getAllEvents();this.events.clear(),this.indices.byDate.clear(),this.indices.byMonth.clear(),this.indices.recurring.clear(),this._notifyChange({type:"clear",oldEvents:e,version:++this.version})}loadEvents(e){this.clear();for(const t of e)this.addEvent(t)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}_indexEvent(e){if(this.optimizer.shouldUseLazyIndexing(e))return void this._indexEventLazy(e);const t=s.startOfDay(new Date(e.startUTC||e.start)),i=s.endOfDay(new Date(e.endUTC||e.end));s.getDateRange(t,i).forEach(t=>{const s=t.toDateString();this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)}),t.getFullYear(),String(t.getMonth()+1).padStart(2,"0"),i.getFullYear(),String(i.getMonth()+1).padStart(2,"0");const n=new Date(t.getFullYear(),t.getMonth(),1);for(;n<=i;){const t=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;this.indices.byMonth.has(t)||this.indices.byMonth.set(t,new Set),this.indices.byMonth.get(t).add(e.id),n.setMonth(n.getMonth()+1)}e.categories&&e.categories.length>0&&e.categories.forEach(t=>{this.indices.byCategory.has(t)||this.indices.byCategory.set(t,new Set),this.indices.byCategory.get(t).add(e.id)}),e.status&&(this.indices.byStatus.has(e.status)||this.indices.byStatus.set(e.status,new Set),this.indices.byStatus.get(e.status).add(e.id)),e.recurring&&this.indices.recurring.add(e.id)}_indexEventLazy(e){this.optimizer.createLazyIndexMarkers(e);const t=s.startOfDay(e.start),i=s.endOfDay(e.end),n=new Date(t);n.setDate(n.getDate()+7);if(s.getDateRange(t,n<i?n:i).forEach(t=>{const s=t.toDateString();this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)}),i>n){const n=new Date(i);n.setDate(n.getDate()-7);s.getDateRange(n>t?n:t,i).forEach(t=>{const s=t.toDateString();this.indices.byDate.has(s)||this.indices.byDate.set(s,new Set),this.indices.byDate.get(s).add(e.id)})}const r=new Date(t.getFullYear(),t.getMonth(),1);for(;r<=i;){const t=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;this.indices.byMonth.has(t)||this.indices.byMonth.set(t,new Set),this.indices.byMonth.get(t).add(e.id),r.setMonth(r.getMonth()+1)}e.categories&&e.categories.length>0&&e.categories.forEach(t=>{this.indices.byCategory.has(t)||this.indices.byCategory.set(t,new Set),this.indices.byCategory.get(t).add(e.id)}),e.status&&(this.indices.byStatus.has(e.status)||this.indices.byStatus.set(e.status,new Set),this.indices.byStatus.get(e.status).add(e.id)),e.recurring&&this.indices.recurring.add(e.id)}_unindexEvent(e){for(const[t,s]of this.indices.byDate)s.delete(e.id),0===s.size&&this.indices.byDate.delete(t);for(const[t,s]of this.indices.byMonth)s.delete(e.id),0===s.size&&this.indices.byMonth.delete(t);this.indices.recurring.delete(e.id)}_notifyChange(e){for(const t of this.listeners)try{t(e)}catch(e){console.error("Error in EventStore listener:",e)}}getStats(){return{totalEvents:this.events.size,recurringEvents:this.indices.recurring.size,indexedDates:this.indices.byDate.size,indexedMonths:this.indices.byMonth.size,indexedCategories:this.indices.byCategory.size,indexedStatuses:this.indices.byStatus.size,version:this.version,performanceMetrics:this.optimizer.getMetrics()}}startBatch(e=!1){this.isBatchMode=!0,this.batchNotifications=[],e&&(this.batchBackup={events:new Map(this.events),indices:{byDate:new Map(Array.from(this.indices.byDate.entries()).map(([e,t])=>[e,new Set(t)])),byMonth:new Map(Array.from(this.indices.byMonth.entries()).map(([e,t])=>[e,new Set(t)])),recurring:new Set(this.indices.recurring),byCategory:new Map(Array.from(this.indices.byCategory.entries()).map(([e,t])=>[e,new Set(t)])),byStatus:new Map(Array.from(this.indices.byStatus.entries()).map(([e,t])=>[e,new Set(t)]))},version:this.version})}commitBatch(){this.isBatchMode&&(this.isBatchMode=!1,this.batchBackup=null,this.batchNotifications.length>0&&this._notifyChange({type:"batch",changes:this.batchNotifications,count:this.batchNotifications.length,version:++this.version}),this.batchNotifications=[])}rollbackBatch(){this.isBatchMode&&(this.isBatchMode=!1,this.batchBackup&&(this.events=this.batchBackup.events,this.indices=this.batchBackup.indices,this.version=this.batchBackup.version,this.batchBackup=null,this.optimizer.clearCache()),this.batchNotifications=[])}async executeBatch(e,t=!0){this.startBatch(t);try{const t=await e();return this.commitBatch(),t}catch(e){throw t&&this.rollbackBatch(),e}}addEvents(e){return this.optimizer.measure("addEvents",()=>{this.startBatch();const t=[],s=[];for(const i of e)try{t.push(this.addEvent(i))}catch(e){s.push({event:i,error:e.message})}return this.commitBatch(),s.length>0&&console.warn(`Failed to add ${s.length} events:`,s),t})}updateEvents(e){return this.optimizer.measure("updateEvents",()=>{this.startBatch();const t=[],s=[];for(const{id:i,updates:n}of e)try{t.push(this.updateEvent(i,n))}catch(e){s.push({id:i,error:e.message})}return this.commitBatch(),s.length>0&&console.warn(`Failed to update ${s.length} events:`,s),t})}removeEvents(e){return this.optimizer.measure("removeEvents",()=>{this.startBatch();let t=0;for(const s of e)this.removeEvent(s)&&t++;return this.commitBatch(),t})}getPerformanceMetrics(){return this.optimizer.getMetrics()}clearCaches(){this.optimizer.eventCache.clear(),this.optimizer.queryCache.clear(),this.optimizer.dateRangeCache.clear()}optimizeIndices(e){e||(e=new Date).setMonth(e.getMonth()-6),e.toDateString();let t=0;for(const[s,i]of this.indices.byDate){if(new Date(s)<e){let n=!1;for(const t of i){const s=this.events.get(t);if(s&&s.end>=e){n=!0;break}}n||(this.indices.byDate.delete(s),t++)}}return console.log(`Optimized indices: removed ${t} old date entries`),t}destroy(){this.clear(),this.optimizer.destroy(),this.listeners.clear()}checkConflicts(e,t={}){return this.conflictDetector.checkConflicts(e,t)}checkEventPairConflicts(e,t,s={}){const i=this.getEvent(e),n=this.getEvent(t);if(!i||!n)throw new Error("One or both events not found");return this.conflictDetector.checkEventPairConflicts(i,n,s)}getAllConflicts(e,t,s={}){const i=this.getEventsInRange(e,t,!1),n=[],r=new Set;for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){const a=`${i[e].id}-${i[t].id}`;if(!r.has(a)){r.add(a);const o=this.conflictDetector.checkEventPairConflicts(i[e],i[t],s);n.push(...o)}}return this.conflictDetector._buildConflictSummary(n,new Set(i.map(e=>e.id)),new Set)}getBusyPeriods(e,t,s,i={}){return this.conflictDetector.getBusyPeriods(e,t,s,i)}getFreePeriods(e,t,s,i={}){return this.conflictDetector.getFreePeriods(e,t,s,i)}addEventWithConflictCheck(e,t=!0){const s=this.checkConflicts(e);if(!t&&s.hasConflicts)throw new Error(`Cannot add event: ${s.totalConflicts} conflicts detected`);return{event:this.addEvent(e),conflicts:s}}findEventsWithConflicts(e={}){const t=[],s=this.getAllEvents();for(const i of s){const s=this.checkConflicts(i,e);s.hasConflicts&&t.push({event:i,conflicts:s.conflicts})}return t}}class c{constructor(e={}){this.state={view:"month",currentDate:new Date,selectedEventId:null,selectedDate:null,hoveredEventId:null,hoveredDate:null,weekStartsOn:0,showWeekNumbers:!1,showWeekends:!0,fixedWeekCount:!0,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:"en-US",hourFormat:"12h",businessHours:{start:"09:00",end:"17:00"},filters:{searchTerm:"",categories:[],showAllDay:!0,showTimed:!0},isDragging:!1,isResizing:!1,isCreating:!1,isLoading:!1,loadingMessage:"",error:null,metadata:{},...e},this.listeners=new Map,this.globalListeners=new Set,this.history=[],this.historyIndex=-1,this.maxHistorySize=50}getState(){return Object.freeze({...this.state})}get(e){return this.state[e]}setState(e){const t=this.state;"function"==typeof e&&(e=e(t));const s={...t,...e,filters:e.filters?{...t.filters,...e.filters}:t.filters,businessHours:e.businessHours?{...t.businessHours,...e.businessHours}:t.businessHours,metadata:e.metadata?{...t.metadata,...e.metadata}:t.metadata};this._hasChanged(t,s)&&(this.state=s,this._addToHistory(s),this._notifyListeners(t,s))}setView(e){const t=["month","week","day","list"];if(!t.includes(e))throw new Error(`Invalid view: ${e}. Must be one of: ${t.join(", ")}`);this.setState({view:e})}setCurrentDate(e){if(e instanceof Date||(e=new Date(e)),isNaN(e.getTime()))throw new Error("Invalid date");this.setState({currentDate:e})}navigateNext(){const{view:e,currentDate:t}=this.state,s=new Date(t);switch(e){case"month":s.setMonth(s.getMonth()+1);break;case"week":s.setDate(s.getDate()+7);break;case"day":s.setDate(s.getDate()+1)}this.setCurrentDate(s)}navigatePrevious(){const{view:e,currentDate:t}=this.state,s=new Date(t);switch(e){case"month":s.setMonth(s.getMonth()-1);break;case"week":s.setDate(s.getDate()-7);break;case"day":s.setDate(s.getDate()-1)}this.setCurrentDate(s)}navigateToday(){this.setCurrentDate(new Date)}selectEvent(e){this.setState({selectedEventId:e})}clearEventSelection(){this.setState({selectedEventId:null})}selectDate(e){e instanceof Date||(e=new Date(e)),this.setState({selectedDate:e})}clearDateSelection(){this.setState({selectedDate:null})}setLoading(e,t=""){this.setState({isLoading:e,loadingMessage:t})}setError(e){this.setState({error:e?e instanceof Error?e.message:e:null})}updateFilters(e){this.setState({filters:{...this.state.filters,...e}})}subscribe(e){return this.globalListeners.add(e),()=>{this.globalListeners.delete(e)}}watch(e,t){const s=Array.isArray(e)?e:[e];return s.forEach(e=>{this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}),()=>{s.forEach(e=>{const s=this.listeners.get(e);s&&(s.delete(t),0===s.size&&this.listeners.delete(e))})}}canUndo(){return this.historyIndex>0}canRedo(){return this.historyIndex<this.history.length-1}getUndoCount(){return this.historyIndex}getRedoCount(){return this.history.length-1-this.historyIndex}undo(){if(!this.canUndo())return!1;this.historyIndex--;const e=this.history[this.historyIndex],t=this.state;return this.state={...e},this._notifyListeners(t,this.state),!0}redo(){if(!this.canRedo())return!1;this.historyIndex++;const e=this.history[this.historyIndex],t=this.state;return this.state={...e},this._notifyListeners(t,this.state),!0}reset(){const e=this.history[0]||{};this.setState(e),this.history=[e],this.historyIndex=0}_hasChanged(e,t){return!this._deepEqual(e,t)}_deepEqual(e,t,s=new Set){if(e===t)return!0;if(null==e||null==t)return e===t;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;if(s.has(e)||s.has(t))return!1;if(s.add(e),s.add(t),Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return s.delete(e),s.delete(t),!1;for(let i=0;i<e.length;i++)if(!this._deepEqual(e[i],t[i],s))return s.delete(e),s.delete(t),!1;return s.delete(e),s.delete(t),!0}if(e instanceof Date&&t instanceof Date){const i=e.getTime()===t.getTime();return s.delete(e),s.delete(t),i}const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return s.delete(e),s.delete(t),!1;i.sort(),n.sort();for(let r=0;r<i.length;r++)if(i[r]!==n[r])return s.delete(e),s.delete(t),!1;for(const n of i)if(!this._deepEqual(e[n],t[n],s))return s.delete(e),s.delete(t),!1;return s.delete(e),s.delete(t),!0}_addToHistory(e){this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push({...e}),this.historyIndex++,this.history.length>this.maxHistorySize&&(this.history.shift(),this.historyIndex--)}_notifyListeners(e,t){for(const s of this.globalListeners)try{s(t,e)}catch(e){console.error("Error in state listener:",e)}for(const[s,i]of this.listeners)if(e[s]!==t[s])for(const n of i)try{n(t[s],e[s],t,e)}catch(e){console.error(`Error in state listener for key "${s}":`,e)}}}class h{constructor(t={}){this.timezoneManager=new e,this.config={view:"month",date:new Date,weekStartsOn:0,locale:"en-US",timeZone:t.timeZone||this.timezoneManager.getSystemTimezone(),showWeekNumbers:!1,showWeekends:!0,fixedWeekCount:!0,businessHours:{start:"09:00",end:"17:00"},...t},this.eventStore=new o({timezone:this.config.timeZone}),this.state=new c({view:this.config.view,currentDate:this.config.date,weekStartsOn:this.config.weekStartsOn,locale:this.config.locale,timeZone:this.config.timeZone,showWeekNumbers:this.config.showWeekNumbers,showWeekends:this.config.showWeekends,fixedWeekCount:this.config.fixedWeekCount,businessHours:this.config.businessHours}),this.listeners=new Map,this.plugins=new Set,this.views=new Map,this._setupInternalListeners(),t.events&&this.setEvents(t.events)}setView(e,t=null){this.state.setView(e),t&&this.state.setCurrentDate(t),this._emit("viewChange",{view:e,date:t||this.state.get("currentDate")})}getView(){return this.state.get("view")}next(){this.state.navigateNext(),this._emit("navigate",{direction:"next",date:this.state.get("currentDate"),view:this.state.get("view")})}previous(){this.state.navigatePrevious(),this._emit("navigate",{direction:"previous",date:this.state.get("currentDate"),view:this.state.get("view")})}today(){this.state.navigateToday(),this._emit("navigate",{direction:"today",date:this.state.get("currentDate"),view:this.state.get("view")})}goToDate(e){this.state.setCurrentDate(e),this._emit("navigate",{direction:"goto",date:e,view:this.state.get("view")})}getCurrentDate(){return new Date(this.state.get("currentDate"))}addEvent(e){const t=this.eventStore.addEvent(e);return this._emit("eventAdd",{event:t}),t}updateEvent(e,t){const s=this.eventStore.getEvent(e),i=this.eventStore.updateEvent(e,t);return this._emit("eventUpdate",{event:i,oldEvent:s}),i}removeEvent(e){const t=this.eventStore.getEvent(e),s=this.eventStore.removeEvent(e);return s&&this._emit("eventRemove",{event:t}),s}getEvent(e){return this.eventStore.getEvent(e)}getEvents(){return this.eventStore.getAllEvents()}setEvents(e){this.eventStore.loadEvents(e),this._emit("eventsSet",{events:this.getEvents()})}queryEvents(e){return this.eventStore.queryEvents(e)}getEventsForDate(e,t=null){return this.eventStore.getEventsForDate(e,t||this.config.timeZone)}getEventsInRange(e,t,s=null){return this.eventStore.getEventsInRange(e,t,!0,s||this.config.timeZone)}setTimezone(e){const t=this.timezoneManager.parseTimezone(e),s=this.config.timeZone;this.config.timeZone=t,this.eventStore.defaultTimezone=t,this.state.setState({timeZone:t}),this._emit("timezoneChange",{timezone:t,previousTimezone:s})}getTimezone(){return this.config.timeZone}convertTimezone(e,t,s){return this.timezoneManager.convertTimezone(e,t,s)}toCalendarTimezone(e,t){return this.timezoneManager.convertTimezone(e,t,this.config.timeZone)}fromCalendarTimezone(e,t){return this.timezoneManager.convertTimezone(e,this.config.timeZone,t)}formatInTimezone(e,t=null,s={}){return this.timezoneManager.formatInTimezone(e,t||this.config.timeZone,s)}getTimezones(){return this.timezoneManager.getCommonTimezones()}getOverlapGroups(e,t=!0){return this.eventStore.getOverlapGroups(e,t)}calculateEventPositions(e){return this.eventStore.calculateEventPositions(e)}getViewData(){const e=this.state.get("view"),t=this.state.get("currentDate");switch(e){case"month":return this._getMonthViewData(t);case"week":return this._getWeekViewData(t);case"day":return this._getDayViewData(t);case"list":return this._getListViewData(t);default:return null}}_getMonthViewData(e){const t=e.getFullYear(),i=e.getMonth(),n=this.state.get("weekStartsOn"),r=this.state.get("fixedWeekCount"),a=new Date(t,i,1),o=new Date(t,i+1,0),c=s.startOfWeek(a,n),h=[];let l=new Date(c);const d=r?6:Math.ceil((o.getDate()+s.getDayOfWeek(a,n))/7);for(let e=0;e<d;e++){const e={weekNumber:s.getWeekNumber(l),days:[]};for(let t=0;t<7;t++){const t=new Date(l),n=t.getMonth()===i,r=s.isToday(t),a=0===t.getDay()||6===t.getDay();e.days.push({date:t,dayOfMonth:t.getDate(),isCurrentMonth:n,isToday:r,isWeekend:a,events:this.getEventsForDate(t)}),l=s.addDays(l,1)}h.push(e)}return{type:"month",year:t,month:i,monthName:s.getMonthName(e,this.state.get("locale")),weeks:h,startDate:c,endDate:new Date(l.getTime()-1)}}_getWeekViewData(e){const t=this.state.get("weekStartsOn"),i=s.startOfWeek(e,t),n=s.endOfWeek(e,t),r=[],a=new Date(i);for(let e=0;e<7;e++){const e=new Date(a);r.push({date:e,dayOfWeek:e.getDay(),dayName:s.getDayName(e,this.state.get("locale")),isToday:s.isToday(e),isWeekend:0===e.getDay()||6===e.getDay(),events:this.getEventsForDate(e),overlapGroups:this.eventStore.getOverlapGroups(e,!0),getEventPositions:e=>this.eventStore.calculateEventPositions(e)}),a=s.addDays(a,1)}return{type:"week",weekNumber:s.getWeekNumber(i),startDate:i,endDate:n,days:r}}_getDayViewData(e){const t=this.getEventsForDate(e),i=t.filter(e=>e.allDay),n=t.filter(e=>!e.allDay),r=[];for(let t=0;t<24;t++){const i=new Date(e);i.setHours(t,0,0,0);const a=new Date(e);a.setHours(t+1,0,0,0),r.push({hour:t,time:s.formatTime(i,this.state.get("locale")),events:n.filter(e=>e.start<a&&e.end>i)})}return{type:"day",date:e,dayName:s.getDayName(e,this.state.get("locale")),isToday:s.isToday(e),allDayEvents:i,hours:r}}_getListViewData(e){const t=new Date(e);t.setHours(0,0,0,0);const i=new Date(t);i.setDate(i.getDate()+30);const n=this.getEventsInRange(t,i),r=new Map;n.forEach(e=>{const t=e.start.toDateString();r.has(t)||r.set(t,{date:new Date(e.start),events:[]}),r.get(t).events.push(e)});return{type:"list",startDate:t,endDate:i,days:Array.from(r.values()).sort((e,t)=>e.date-t.date).map(e=>({...e,dayName:s.getDayName(e.date,this.state.get("locale")),isToday:s.isToday(e.date)})),totalEvents:n.length}}selectEvent(e){const t=this.getEvent(e);t&&(this.state.selectEvent(e),this._emit("eventSelect",{event:t}))}clearEventSelection(){const e=this.state.get("selectedEventId");this.state.clearEventSelection(),e&&this._emit("eventDeselect",{eventId:e})}selectDate(e){this.state.selectDate(e),this._emit("dateSelect",{date:e})}clearDateSelection(){const e=this.state.get("selectedDate");this.state.clearDateSelection(),e&&this._emit("dateDeselect",{date:e})}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const s=this.listeners.get(e);s&&(s.delete(t),0===s.size&&this.listeners.delete(e))}_emit(e,t){const s=this.listeners.get(e);s&&s.forEach(s=>{try{s(t)}catch(t){console.error(`Error in event listener for "${e}":`,t)}})}_setupInternalListeners(){this.state.subscribe((e,t)=>{this._emit("stateChange",{newState:e,oldState:t})}),this.eventStore.subscribe(e=>{this._emit("eventStoreChange",e)})}use(e){if(this.plugins.has(e))console.warn("Plugin already installed");else{if("function"!=typeof e.install)throw new Error("Plugin must have an install method");e.install(this),this.plugins.add(e)}}destroy(){this.listeners.clear(),this.eventStore.clear(),this.plugins.forEach(e=>{"function"==typeof e.uninstall&&e.uninstall(this)}),this.plugins.clear(),this._emit("destroy")}}const l="0.1.0";export{h as Calendar,s as DateUtils,t as Event,o as EventStore,c as StateManager,l as VERSION,h as default};
//# sourceMappingURL=calendar-core.esm.min.js.map
