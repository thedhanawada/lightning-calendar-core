<apex:page controller="CalendarController" showHeader="false" standardStylesheets="false" sidebar="false">
    <html>
    <head>
        <title>Lightning Calendar in Visualforce</title>
        <style>
            body {
                font-family: 'Salesforce Sans', Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background: #f4f6f9;
            }
            .slds-card {
                background: white;
                border-radius: 0.25rem;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.1);
                padding: 1rem;
                margin-bottom: 1rem;
            }
            .calendar-container {
                min-height: 600px;
            }
            .header {
                padding: 1rem;
                background: white;
                border-bottom: 1px solid #dddbda;
                margin-bottom: 1rem;
            }
            h1 {
                font-size: 1.5rem;
                font-weight: 300;
                color: #080707;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>Lightning Calendar Core - Visualforce Example</h1>
            <p>Using Lightning Calendar in a Visualforce page with Apex controller</p>
        </div>

        <div class="slds-card">
            <div id="calendar" class="calendar-container"></div>
        </div>

        <!-- Load Calendar from Static Resource -->
        <apex:includeScript value="{!$Resource.LightningCalendar}"/>

        <script>
            // Wait for library to load
            window.onload = function() {
                // Initialize calendar
                const calendar = new window.LightningCalendar.Calendar();
                const container = document.getElementById('calendar');
                const renderer = new window.LightningCalendar.VanillaDOMRenderer(container, calendar);

                // Load events from Apex controller
                loadSalesforceEvents();

                // Handle event clicks
                calendar.on('eventClick', function(event) {
                    // Navigate to Salesforce record
                    if (event.metadata && event.metadata.recordId) {
                        window.location.href = '/' + event.metadata.recordId;
                    }
                });

                // Function to load events from Salesforce
                function loadSalesforceEvents() {
                    // Call Apex controller method
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.CalendarController.getEvents}',
                        function(result, event) {
                            if (event.status) {
                                // Transform Salesforce events to calendar format
                                const calendarEvents = result.map(function(sfEvent) {
                                    return {
                                        id: sfEvent.Id,
                                        title: sfEvent.Subject,
                                        start: new Date(sfEvent.StartDateTime),
                                        end: new Date(sfEvent.EndDateTime),
                                        allDay: sfEvent.IsAllDayEvent,
                                        description: sfEvent.Description,
                                        color: getEventColor(sfEvent.Type),
                                        metadata: {
                                            recordId: sfEvent.Id,
                                            type: sfEvent.Type,
                                            ownerId: sfEvent.OwnerId
                                        }
                                    };
                                });

                                // Add events to calendar
                                calendar.setEvents(calendarEvents);
                            } else {
                                console.error('Error loading events:', event.message);
                            }
                        },
                        {escape: true}
                    );
                }

                // Helper function for event colors
                function getEventColor(eventType) {
                    const colors = {
                        'Meeting': '#0070f3',
                        'Call': '#00c853',
                        'Task': '#ff6b6b',
                        'Other': '#9c27b0'
                    };
                    return colors[eventType] || '#666666';
                }

                // Add create event functionality
                calendar.on('dateClick', function(date) {
                    if (confirm('Create new event on ' + date.toLocaleDateString() + '?')) {
                        // Call Apex to create event
                        createSalesforceEvent(date);
                    }
                });

                function createSalesforceEvent(date) {
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.CalendarController.createEvent}',
                        date.toISOString(),
                        'New Event',
                        function(result, event) {
                            if (event.status) {
                                // Reload events
                                loadSalesforceEvents();
                            }
                        },
                        {escape: true}
                    );
                }
            };
        </script>
    </body>
    </html>
</apex:page>