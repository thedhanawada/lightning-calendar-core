<template>
    <lightning-card title={calendarTitle} icon-name="standard:event">
        <!-- Controls -->
        <div slot="actions">
            <lightning-button-group>
                <lightning-button
                    label="Month"
                    data-view="month"
                    variant={monthViewVariant}
                    onclick={handleViewChange}>
                </lightning-button>
                <lightning-button
                    label="Week"
                    data-view="week"
                    variant={weekViewVariant}
                    onclick={handleViewChange}>
                </lightning-button>
                <lightning-button
                    label="Day"
                    data-view="day"
                    variant={dayViewVariant}
                    onclick={handleViewChange}>
                </lightning-button>
                <lightning-button
                    label="List"
                    data-view="list"
                    variant={listViewVariant}
                    onclick={handleViewChange}>
                </lightning-button>
            </lightning-button-group>

            <lightning-button-group class="slds-m-left_x-small">
                <lightning-button
                    icon-name="utility:chevronleft"
                    variant="neutral"
                    onclick={handlePrevious}>
                </lightning-button>
                <lightning-button
                    label="Today"
                    variant="neutral"
                    onclick={handleToday}>
                </lightning-button>
                <lightning-button
                    icon-name="utility:chevronright"
                    variant="neutral"
                    onclick={handleNext}>
                </lightning-button>
            </lightning-button-group>
        </div>

        <!-- Calendar Body -->
        <div class="slds-card__body slds-card__body_inner" style={containerStyle}>
            <!-- Month View -->
            <template if:true={isMonthView}>
                <div class="calendar-container">
                    <!-- Weekday Headers -->
                    <div class="calendar-weekdays">
                        <template for:each={weekDayNames} for:item="day">
                            <div key={day} class="calendar-weekday">{day}</div>
                        </template>
                    </div>

                    <!-- Month Grid -->
                    <div class="calendar-month">
                        <template for:each={monthViewData} for:item="week">
                            <div key={week} class="calendar-week">
                                <template for:each={week.days} for:item="day">
                                    <div
                                        key={day.date}
                                        class={day.dayClass}
                                        data-date={day.date}
                                        onclick={handleDateClick}>

                                        <div class="day-number">{day.dayNumber}</div>

                                        <template if:true={day.hasEvents}>
                                            <template for:each={day.events} for:item="event">
                                                <div
                                                    key={event.id}
                                                    class="calendar-event"
                                                    data-event-id={event.id}
                                                    onclick={handleEventClick}>
                                                    {event.title}
                                                </div>
                                            </template>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </template>

            <!-- Week View -->
            <template if:true={isWeekView}>
                <template if:true={weekViewData}>
                    <div class="calendar-week-view">
                        <template for:each={weekViewData.days} for:item="day">
                            <div key={day.date} class="week-day-column">
                                <div class="week-day-header">
                                    <div class="slds-text-title">{day.dayName}</div>
                                    <div class={day.isToday}>{day.dayNumber}</div>
                                </div>
                                <div class="week-day-events">
                                    <template if:true={day.hasEvents}>
                                        <template for:each={day.events} for:item="event">
                                            <div
                                                key={event.id}
                                                class="week-event"
                                                data-event-id={event.id}
                                                onclick={handleEventClick}>
                                                {event.title}
                                            </div>
                                        </template>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </template>

            <!-- Day View -->
            <template if:true={isDayView}>
                <template if:true={dayViewData}>
                    <div class="calendar-day-view">
                        <div class="day-view-header">
                            <h2 class="slds-text-heading_medium">{dayViewData.dayName}</h2>
                        </div>

                        <template if:true={dayViewData.allDayEvents.length}>
                            <div class="all-day-events">
                                <div class="slds-text-title slds-m-bottom_x-small">All Day</div>
                                <template for:each={dayViewData.allDayEvents} for:item="event">
                                    <div
                                        key={event.id}
                                        class="all-day-event"
                                        data-event-id={event.id}
                                        onclick={handleEventClick}>
                                        {event.title}
                                    </div>
                                </template>
                            </div>
                        </template>

                        <div class="time-slots">
                            <template for:each={dayViewData.hours} for:item="hour">
                                <div key={hour.hour} class="time-slot">
                                    <div class="time-label">{hour.time}</div>
                                    <div class="time-slot-events">
                                        <template for:each={hour.events} for:item="event">
                                            <div
                                                key={event.id}
                                                class="time-event"
                                                data-event-id={event.id}
                                                onclick={handleEventClick}>
                                                {event.title}
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </template>

            <!-- List View -->
            <template if:true={isListView}>
                <template if:true={listViewData}>
                    <div class="calendar-list-view">
                        <template for:each={listViewData.days} for:item="day">
                            <div key={day.date} class="list-day">
                                <div class="list-day-header">
                                    <h3 class="slds-text-heading_small">{day.dayName}</h3>
                                    <p class="slds-text-body_small slds-text-color_weak">{day.dateFormatted}</p>
                                </div>
                                <template if:true={day.hasEvents}>
                                    <ul class="slds-list_dotted">
                                        <template for:each={day.events} for:item="event">
                                            <li
                                                key={event.id}
                                                class="list-event"
                                                data-event-id={event.id}
                                                onclick={handleEventClick}>
                                                <span class="slds-text-body_regular">{event.title}</span>
                                            </li>
                                        </template>
                                    </ul>
                                </template>
                                <template if:false={day.hasEvents}>
                                    <p class="slds-text-color_weak slds-m-left_small">No events</p>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </template>
        </div>
    </lightning-card>
</template>
